<?xml version="1.0" encoding="UTF-8"?>
 
<config charset="ISO-8859-1">
 
    <var-def name="repOut">C:/Users/REDA/Desktop/scraping/</var-def>
    <var-def name="maxLoop">10</var-def>
    <var-def name="startUrl">http://www.leboncoin.fr/voitures/offres/ile_de_france/occasions</var-def>
    
     <file action="write" path="${repOut}bc_${sys.date()}${sys.time()}.pa" charset="UTF-8">                        
		<template>
	        <![CDATA[ <newyourk_times date="${sys.datetime("dd.MM.yyyy")}"> ]]>
	    </template>
    
		<while  condition="true"
			index="i" 
	        maxloops="${maxLoop}"
	        empty="empty">						
			
			<loop item="annonceUrl" index="j">
				<list>		                
				    <xpath expression="//td[@style='white-space: nowrap;']/a/@href">
				        <html-to-xml>
			                <http url="${startUrl}?o=${i}"/>
			            </html-to-xml>
				    </xpath>						
	            </list>		            
	            <body>          	                 			            	
					<loop item="annonceItem" index="k">                	
						<list>
							<xpath expression="//div[@class='lbcAdContainer']">
						        <html-to-xml>
				                    <http url="${annonceUrl}"/>
				                </html-to-xml>
						    </xpath>						
						</list>
						<body>							
							<xquery>
								<xq-param name="doc">
			                       <html-to-xml>
				                        <http url="${annonceUrl}"/>
				                    </html-to-xml> 
			                    </xq-param>		                    			            					
								<xq-expression><![CDATA[
			                        declare variable $doc as node() external;
			                        
			                        let $title := data($doc//span[@class='ad_links']/h1)
			                        return
			                           
			                                <title>{data($title)}</title>
			                           
			                    ]]></xq-expression>
			                </xquery>							
						</body>
					</loop>	      		            	
	            </body>
			</loop>				
		</while>
	</file>			
</config>